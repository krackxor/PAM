{% extends "base.html" %}

{% block title %}Home - SUNTER{% endblock %}

{% block content %}
<!-- Welcome Section -->
<div class="card" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; border: none;">
    <div class="card-body" style="padding: var(--space-5);">
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: var(--space-2);">
            <i class="fas fa-tint"></i> SUNTER Dashboard
        </h1>
        <p style="font-size: 14px; opacity: 0.9; margin: 0;">
            Sistem Monitoring Collection & Analisa PDAM Sunter
        </p>
    </div>
</div>

<!-- Quick Stats -->
<div class="row kpi-cards">
    <div class="col-6 col-md-3">
        <div class="kpi-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none;">
            <div class="kpi-label" style="color: rgba(255,255,255,0.8);">
                <i class="fas fa-users"></i>
                Total Pelanggan
            </div>
            <div class="kpi-value" id="total-pelanggan">-</div>
            <div class="kpi-change" style="color: rgba(255,255,255,0.8);">
                <i class="fas fa-database"></i> Data bulan ini
            </div>
        </div>
    </div>
    
    <div class="col-6 col-md-3">
        <div class="kpi-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none;">
            <div class="kpi-label" style="color: rgba(255,255,255,0.8);">
                <i class="fas fa-check-circle"></i>
                Sudah Bayar
            </div>
            <div class="kpi-value" id="sudah-bayar">-</div>
            <div class="kpi-change" style="color: rgba(255,255,255,0.8);">
                <i class="fas fa-percentage"></i> <span id="persen-bayar">0</span>%
            </div>
        </div>
    </div>
    
    <div class="col-6 col-md-3">
        <div class="kpi-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none;">
            <div class="kpi-label" style="color: rgba(255,255,255,0.8);">
                <i class="fas fa-exclamation-circle"></i>
                Belum Bayar
            </div>
            <div class="kpi-value" id="belum-bayar">-</div>
            <div class="kpi-change" style="color: rgba(255,255,255,0.8);">
                <i class="fas fa-user-times"></i> Pelanggan
            </div>
        </div>
    </div>
    
    <div class="col-6 col-md-3">
        <div class="kpi-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none;">
            <div class="kpi-label" style="color: rgba(255,255,255,0.8);">
                <i class="fas fa-money-bill-wave"></i>
                Collection
            </div>
            <div class="kpi-value" id="total-collection">-</div>
            <div class="kpi-change" style="color: rgba(255,255,255,0.8);">
                <i class="fas fa-arrow-up"></i> Bulan ini
            </div>
        </div>
    </div>
</div>

<!-- Quick Menu -->
<div class="card">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-rocket"></i>
            Menu Cepat
        </div>
    </div>
    <div class="card-body">
        <div class="row" style="gap: var(--space-3);">
            <div class="col-6 col-md-3" style="padding: 0;">
                <a href="/collection" style="text-decoration: none;">
                    <div class="kpi-card" style="text-align: center; cursor: pointer; transition: transform 0.2s;">
                        <i class="fas fa-wallet" style="font-size: 32px; color: var(--primary); margin-bottom: var(--space-2);"></i>
                        <div style="font-weight: 600; color: var(--text-primary);">Collection</div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: var(--space-1);">Lihat data collection</div>
                    </div>
                </a>
            </div>
            
            <div class="col-6 col-md-3" style="padding: 0;">
                <a href="/belum-bayar" style="text-decoration: none;">
                    <div class="kpi-card" style="text-align: center; cursor: pointer; transition: transform 0.2s;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 32px; color: var(--warning); margin-bottom: var(--space-2);"></i>
                        <div style="font-weight: 600; color: var(--text-primary);">Belum Bayar</div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: var(--space-1);">Cek tunggakan</div>
                    </div>
                </a>
            </div>
            
            <div class="col-6 col-md-3" style="padding: 0;">
                <a href="/upload" style="text-decoration: none;">
                    <div class="kpi-card" style="text-align: center; cursor: pointer; transition: transform 0.2s;">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 32px; color: var(--success); margin-bottom: var(--space-2);"></i>
                        <div style="font-weight: 600; color: var(--text-primary);">Upload</div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: var(--space-1);">Upload data baru</div>
                    </div>
                </a>
            </div>
            
            <div class="col-6 col-md-3" style="padding: 0;">
                <a href="/menu" style="text-decoration: none;">
                    <div class="kpi-card" style="text-align: center; cursor: pointer; transition: transform 0.2s;">
                        <i class="fas fa-bars" style="font-size: 32px; color: var(--info); margin-bottom: var(--space-2);"></i>
                        <div style="font-weight: 600; color: var(--text-primary);">Menu Lainnya</div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: var(--space-1);">Fitur lengkap</div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="card">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-history"></i>
            Aktivitas Terbaru
        </div>
    </div>
    <div class="card-body" style="padding: 0;">
        <div class="table-responsive">
            <table class="table" id="recentActivity">
                <thead>
                    <tr>
                        <th>Waktu</th>
                        <th>Aktivitas</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="3" class="loading">
                            <div class="spinner"></div>
                            <p>Loading...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Info Card -->
<div class="card" style="background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); border: none;">
    <div class="card-body">
        <div style="display: flex; align-items: center; gap: var(--space-3);">
            <i class="fas fa-info-circle" style="font-size: 32px; color: var(--primary);"></i>
            <div>
                <div style="font-weight: 700; margin-bottom: var(--space-1);">Sistem Informasi PDAM</div>
                <div style="font-size: 13px; color: var(--text-secondary);">
                    Dashboard monitoring collection dan analisa data pelanggan PDAM Sunter. 
                    Gunakan menu di bawah untuk navigasi cepat.
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Load dashboard stats
async function loadStats() {
    try {
        // Get current month/year
        const now = new Date();
        const bulan = now.getMonth() + 1;
        const tahun = now.getFullYear();
        
        // Load KPI data
        const kpi = await App.api(`/api/kpi?bulan=${bulan}&tahun=${tahun}`);
        
        // Update stats
        document.getElementById('total-pelanggan').textContent = App.formatNumber(kpi.pelanggan_aktif || 0);
        
        const sudahBayar = kpi.pelanggan_aktif - (kpi.pelanggan_belum_bayar || 0);
        document.getElementById('sudah-bayar').textContent = App.formatNumber(sudahBayar);
        document.getElementById('belum-bayar').textContent = App.formatNumber(kpi.pelanggan_belum_bayar || 0);
        
        const persenBayar = kpi.pelanggan_aktif > 0 ? (sudahBayar / kpi.pelanggan_aktif * 100) : 0;
        document.getElementById('persen-bayar').textContent = persenBayar.toFixed(1);
        
        document.getElementById('total-collection').textContent = App.formatRupiah(kpi.collection_total || 0);
        
        // Load recent activity (placeholder)
        loadRecentActivity();
        
    } catch (error) {
        console.error('Error loading stats:', error);
        // Show default values
        document.getElementById('total-pelanggan').textContent = '-';
        document.getElementById('sudah-bayar').textContent = '-';
        document.getElementById('belum-bayar').textContent = '-';
        document.getElementById('total-collection').textContent = '-';
    }
}

function loadRecentActivity() {
    const tbody = document.querySelector('#recentActivity tbody');
    
    // Placeholder data
    const activities = [
        { time: '10 menit lalu', activity: 'Upload data collection', status: 'success' },
        { time: '1 jam lalu', activity: 'Generate report bulanan', status: 'success' },
        { time: '2 jam lalu', activity: 'Update master pelanggan', status: 'success' }
    ];
    
    tbody.innerHTML = activities.map(item => `
        <tr>
            <td style="white-space: nowrap;">${item.time}</td>
            <td>${item.activity}</td>
            <td><span class="badge badge-success">Sukses</span></td>
        </tr>
    `).join('');
}

// Add hover effect to menu cards
document.querySelectorAll('.kpi-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.02)';
    });
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
    });
});

// Load on page load
window.addEventListener('DOMContentLoaded', loadStats);
</script>
{% endblock %}
